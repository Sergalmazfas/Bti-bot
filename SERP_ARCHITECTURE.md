# üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞ SERP API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–∏ –¥–ª—è BTI Bot

## üìã –û–±—â–∞—è –∞—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

### **Source of Truth - –ì–æ—Å—Ä–µ–µ—Å—Ç—Ä**
- **–û—Å–Ω–æ–≤–Ω–æ–π –æ–±—ä–µ–∫—Ç**: –ö–∞—Ä—Ç–æ—á–∫–∞ –≤ –≥–æ—Å—Ä–µ–µ—Å—Ç—Ä–µ –ø–æ –∫–∞–¥–∞—Å—Ç—Ä–æ–≤–æ–º—É –Ω–æ–º–µ—Ä—É
- **–§—É–Ω–∫—Ü–∏—è**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –∏ –ø–æ–ª—É—á–µ–Ω–∏–µ –±–∞–∑–æ–≤—ã—Ö –¥–∞–Ω–Ω—ã—Ö
- **–ö—Ä–∏—Ç–∏—á–Ω–æ—Å—Ç—å**: –ï—Å–ª–∏ –∫–∞—Ä—Ç–æ—á–∫–∞ –∏—Å—á–µ–∑–∞–µ—Ç ‚Üí ALERT (—Ä—É—á–Ω–æ–µ –≤–º–µ—à–∞—Ç–µ–ª—å—Å—Ç–≤–æ)

### **SERP API - –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ –¥–∞–Ω–Ω—ã–µ**
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ü–æ–ª—É—á–µ–Ω–∏–µ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö –∏ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
- **–ü–∞—Ä–∞–º–µ—Ç—Ä—ã**: –õ–æ–∫–∞—Ü–∏—è, —Ü–µ–Ω—ã, –ø–∞—Ä–∞–º–µ—Ç—Ä—ã –æ–±—ä–µ–∫—Ç–æ–≤, –∞–¥—Ä–µ—Å–∞
- **–û–≥—Ä–∞–Ω–∏—á–µ–Ω–∏—è**: Rate limiting, retry logic, error handling

### **–ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ —Ü–µ–Ω–æ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏—è**
–¢—Ä–∏ —Ç–∏–ø–∞ —Ä–∞—Å—á–µ—Ç–æ–≤ –¥–ª—è –∫–∞–∂–¥–æ–≥–æ –æ–±—ä–µ–∫—Ç–∞:

#### 1. **–¢–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç** (–û—Ñ–∏—Ü–∏–∞–ª—å–Ω—ã–π)
- **–û—Å–Ω–æ–≤–∞**: –î–∞–Ω–Ω—ã–µ –ë–¢–ò/—Ä–µ–µ—Å—Ç—Ä–∞
- **–†–∞—Å—á–µ—Ç**: –ü–ª–æ—â–∞–¥—å √ó –±–∞–∑–æ–≤–∞—è —Å—Ç–∞–≤–∫–∞
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –û—Ñ–∏—Ü–∏–∞–ª—å–Ω–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å

#### 2. **–ó–∞–º–µ—Ä—ã** (–ö–æ—Ä—Ä–µ–∫—Ü–∏—è)
- **–û—Å–Ω–æ–≤–∞**: –û–±–º–µ—Ä—ã/–ø–ª–æ—â–∞–¥—å + —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- **–ö–æ—Ä—Ä–µ–∫—Ü–∏—è**: –ü–æ —Ä—ã–Ω–æ—á–Ω—ã–º –¥–∞–Ω–Ω—ã–º –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –†–µ–∞–ª–∏—Å—Ç–∏—á–Ω–∞—è –æ—Ü–µ–Ω–∫–∞

#### 3. **–¢–µ—Ö–∑–∞–¥–∞–Ω–∏–µ** (–ö–æ–º–º–µ—Ä—á–µ—Å–∫–∏–π)
- **–û—Å–Ω–æ–≤–∞**: –†—ã–Ω–æ—á–Ω–∞—è –æ—Ü–µ–Ω–∫–∞ + —Å–ø—Ä–æ—Å
- **–§–∞–∫—Ç–æ—Ä—ã**: –ö–æ–Ω–∫—É—Ä–µ–Ω—Ç—ã, –ª–æ–∫–∞—Ü–∏—è, —Å–æ—Å—Ç–æ—è–Ω–∏–µ
- **–ù–∞–∑–Ω–∞—á–µ–Ω–∏–µ**: –ö–æ–º–º–µ—Ä—á–µ—Å–∫–∞—è —Å—Ç–æ–∏–º–æ—Å—Ç—å

### **–•—Ä–∞–Ω–∏–ª–∏—â–µ –¥–∞–Ω–Ω—ã—Ö**
- **Firestore**: Document per cadastral_number
- **–°—Ç—Ä—É–∫—Ç—É—Ä–∞**: 3 –∫–∞—Ä—Ç–æ—á–∫–∏ + –º–µ—Ç–∞–¥–∞–Ω–Ω—ã–µ
- **–ú–µ—Ç–∞**: timestamp, source, competitors_count

### **–ü–∞–π–ø–ª–∞–π–Ω –æ–±—Ä–∞–±–æ—Ç–∫–∏**
```
Trigger ‚Üí Check Registry ‚Üí SERP API ‚Üí Calculate Prices ‚Üí Save to DB ‚Üí API Response
```

#### **–î–µ—Ç–∞–ª—å–Ω—ã–π –ø–∞–π–ø–ª–∞–π–Ω:**
1. **Trigger**: –ù–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å / —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
2. **Registry Check**: –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å—É—â–µ—Å—Ç–≤–æ–≤–∞–Ω–∏—è –≤ –≥–æ—Å—Ä–µ–µ—Å—Ç—Ä–µ
3. **SERP Call**: –ü–æ–ª—É—á–µ–Ω–∏–µ –∫–æ–Ω–∫—É—Ä–µ–Ω—Ç–æ–≤ –∏ —Ä—ã–Ω–æ—á–Ω—ã—Ö –¥–∞–Ω–Ω—ã—Ö
4. **Price Calculation**: –†–∞—Å—á–µ—Ç 3 —Ç–∏–ø–æ–≤ —Ü–µ–Ω
5. **Database Save**: –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Firestore
6. **API Response**: –í–æ–∑–≤—Ä–∞—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–∞

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥ –∏ –∞–ª–µ—Ä—Ç—ã**
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ**: –í—Å–µ —ç—Ç–∞–ø—ã —Å –¥–µ—Ç–∞–ª–∏–∑–∞—Ü–∏–µ–π
- **–ú–µ—Ç—Ä–∏–∫–∏**: –£—Å–ø–µ—Ö/–æ—à–∏–±–∫–∏ –ø–æ —ç—Ç–∞–ø–∞–º
- **–ê–ª–µ—Ä—Ç—ã**: 
  - –ü—Ä–æ–ø–∞–∂–∞ subject –≤ —Ä–µ–µ—Å—Ç—Ä–µ
  - –ü–∞–¥–µ–Ω–∏–µ SERP API
  - –ö—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏ —Ä–∞—Å—á–µ—Ç–∞

## üîÑ **–ü–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å —Ä–∞–±–æ—Ç**

### **–≠—Ç–∞–ø 1: –ü–æ–¥–≥–æ—Ç–æ–≤–∫–∞ –∏–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä—ã**
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Firestore
- –°–æ–∑–¥–∞–Ω–∏–µ Secret Manager –¥–ª—è API –∫–ª—é—á–µ–π
- –ù–∞—Å—Ç—Ä–æ–π–∫–∞ Cloud Run –¥–ª—è –æ–±—Ä–∞–±–æ—Ç–∫–∏

### **–≠—Ç–∞–ø 2: –ë–∞–∑–æ–≤—ã–µ –º–æ–¥—É–ª–∏**
- SERP API –∫–ª–∏–µ–Ω—Ç —Å retry logic
- Registry –ø—Ä–æ–≤–µ—Ä–∫–∞
- Firestore wrapper

### **–≠—Ç–∞–ø 3: –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞**
- –†–∞—Å—á–µ—Ç —Ç–µ—Ö–ø–∞—Å–ø–æ—Ä—Ç–∞
- –†–∞—Å—á–µ—Ç –∑–∞–º–µ—Ä–æ–≤
- –†–∞—Å—á–µ—Ç —Ç–µ—Ö–∑–∞–¥–∞–Ω–∏—è

### **–≠—Ç–∞–ø 4: –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è**
- –û–±—ä–µ–¥–∏–Ω–µ–Ω–∏–µ –≤—Å–µ—Ö –º–æ–¥—É–ª–µ–π
- API endpoints
- Error handling

### **–≠—Ç–∞–ø 5: –ê–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è**
- Cloud Scheduler
- Pub/Sub —Ç—Ä–∏–≥–≥–µ—Ä—ã
- –ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥

### **–≠—Ç–∞–ø 6: –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ**
- Unit —Ç–µ—Å—Ç—ã
- Integration —Ç–µ—Å—Ç—ã
- End-to-end —Ç–µ—Å—Ç—ã

## üìä **–ö—Ä–∏—Ç–µ—Ä–∏–∏ —É—Å–ø–µ—Ö–∞**

### **–§—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ –ü–æ–ª—É—á–µ–Ω–∏–µ –¥–∞–Ω–Ω—ã—Ö –∏–∑ –≥–æ—Å—Ä–µ–µ—Å—Ç—Ä–∞
- ‚úÖ –ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å SERP API
- ‚úÖ –†–∞—Å—á–µ—Ç 3 —Ç–∏–ø–æ–≤ —Ü–µ–Ω
- ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –≤ Firestore
- ‚úÖ API –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤

### **–ù–µ—Ñ—É–Ω–∫—Ü–∏–æ–Ω–∞–ª—å–Ω—ã–µ —Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è:**
- ‚úÖ Retry logic –¥–ª—è –≤–Ω–µ—à–Ω–∏—Ö API
- ‚úÖ Rate limiting handling
- ‚úÖ Error monitoring
- ‚úÖ Idempotency
- ‚úÖ Performance < 30 —Å–µ–∫ –Ω–∞ –∑–∞–ø—Ä–æ—Å

### **–ú–æ–Ω–∏—Ç–æ—Ä–∏–Ω–≥:**
- ‚úÖ –õ–æ–≥–∏ –≤—Å–µ—Ö –æ–ø–µ—Ä–∞—Ü–∏–π
- ‚úÖ –ú–µ—Ç—Ä–∏–∫–∏ —É—Å–ø–µ—Ö–∞/–æ—à–∏–±–æ–∫
- ‚úÖ –ê–ª–µ—Ä—Ç—ã –Ω–∞ –∫—Ä–∏—Ç–∏—á–µ—Å–∫–∏–µ –æ—à–∏–±–∫–∏
- ‚úÖ Dashboard –¥–ª—è –æ—Ç—Å–ª–µ–∂–∏–≤–∞–Ω–∏—è

